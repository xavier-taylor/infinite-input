# API Project structure

## repository

This layer enscapulates access to the persistence layer - at the moment, a postgresql database. Graphql Docs suggest that authorization might suitably live here.

### repository/sql-model.ts

The ultimate source of truth for the persistence layer of this project is currently the SQL model stored in ../db/schema/mandarin.sql. sql-model.ts file contains autogenerated typescript interfaces corresponding to the sql tables (which themselves might be manually updated during development!).

Currently using @rmp135/sql-ts, until/unless the kanel bug gets fixed. TODO create github issue for it.

## resolvers

This contains the graphql resolvers, whose job it is to process queries and mutations. These should not contain auth logic. Repository objects are dependencies that need to be made available in resolvers. Resolvers return objects defined in the gql schema, which have typescript types defined in src/gql-model https://the-guild.dev/blog/better-type-safety-for-resolvers-with-graphql-codegen
Note that it might help to start using the 'mappers' concept described in that article and here: https://www.graphql-code-generator.com/docs/plugins/typescript-resolvers

## schema

This contains the graphql schema, which itself is composed of type definitions, query definitions and mutation definitions.

### schema/gql-model.ts

This file contains typescript types that represent the model defined in the graphql schema.
These are automatically generated. See docs including https://the-guild.dev/blog/better-type-safety-for-resolvers-with-graphql-codegen

# .env

Your dotenv needs:
FILES_PATH= absolute path (until I work out something smarter) to a files folder for common files
These postgres badboys are needed for int tests and actual code.
Note that int tests need to set their own PGDATABASE at the code level to 'test'
PGUSER=
PGPASSWORD=
PGDATABASE=

# SQL Model

The source of truth for the SQL model is the schema stored in ../db/schema/mandarin.sql.

I tried using kanel, but unfortunately it doesn't support composite keys.

In the future, it would be good to have something like kanel/slonik etc available to give me interfaces for the results of my sql queries.
